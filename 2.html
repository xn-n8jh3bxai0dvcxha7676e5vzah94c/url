<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>URL生成ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
</head>
<body>
    <h1>URL生成ツール</h1>
    <div>
        <label for="urlInput">URL:</label>
        <input type="text" id="urlInput" placeholder="入力するURLをここに">
        <br>
        <label for="passwordInput">パスワード (任意):</label>
        <input type="text" id="passwordInput" placeholder="任意のパスワードを入力">
        <br>
        <button id="generateButton">生成する</button>
    </div>
    <div id="result"></div>
    
    <script>
        class Encryptor {
            constructor(repeatCount) {
                this.repeatCount = repeatCount;
            }

            encrypt(data) {
                let encryptedData = data;
                for (let i = 0; i < this.repeatCount; i++) {
                    let newData = '';
                    for (let j = 0; j < encryptedData.length; j++) {
                        newData += (encryptedData[j] === '0') ? '1' : '0'; // ビット逆転処理
                    }
                    encryptedData = newData;
                }
                return encryptedData;
            }
        }

        document.getElementById('generateButton').addEventListener('click', function () {
            const url = document.getElementById('urlInput').value;
            const password = document.getElementById('passwordInput').value;

            const encryptor = new Encryptor(5);
            const encryptedUrl = encryptor.encrypt(url);
            const encryptedPassword = password ? encryptor.encrypt(password) : null;

            const base64Key = CryptoJS.enc.Base64.stringify(CryptoJS.lib.WordArray.random(16)); // ランダムキー生成
            const data = {
                u: encryptedUrl,
                p: encryptedPassword,
                k: base64Key
            };

            const base64Data = btoa(JSON.stringify(data)); // Base64エンコーディング
            const generatedUrl = window.location.origin + '/path/to/tool/' + base64Data;

            document.getElementById('result').innerText = `生成されたURL: ${generatedUrl}`;
        });
    </script>
</body>
</html>
